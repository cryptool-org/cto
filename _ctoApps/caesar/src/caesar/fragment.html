<!-- text input -->
<div class="form-group mt-3">
    <label for="caesar-input">${{caesar.INPUT_LABEL}}$</label>
    <textarea spellcheck="false" rows="4" class="form-control" id="caesar-input">${{caesar.INIT_TEXT}}$</textarea>
</div>

<!-- encipher / decipher -->
<div id="caesar-mode-switch" class="row mt-2 mb-2 ml-auto">
    <label for="caesar-crypt-checkbox" class="mr-2 left-switch-label">${{caesar.ENCIPHER}}$</label>
    <div id="caesar-crypt-checkbox-wrapper" class="custom-control custom-switch">
        <input id="caesar-crypt-checkbox" type="checkbox" class="custom-control-input">
        <label for="caesar-crypt-checkbox" class="custom-control-label right-switch-label">${{caesar.DECIPHER}}$</label>
    </div>
</div>

<!-- tabs card -->
<div class="card">

    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" id="caesar-options-alphabet-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" href="#caesar-options-tab" role="tab" aria-controls="caesar-options-tab" aria-selected="true"><i class="fa fa-cog mr-2"></i>${{caesar.OPTIONS}}$</a>
            </li>
            <li class="nav-item">
                <a class="nav-link"  href="#caesar-alphabet-tab" role="tab" aria-controls="caesar-alphabet-tab" aria-selected="false"><i class="fa fa-font mr-2" aria-hidden="true"></i>Alphabet</a>
            </li>
        </ul>
        <script>
            // make these (custom) tab links work
            $("#caesar-options-alphabet-tab a").on("click", function (e) {
                e.preventDefault();
                $(this).tab("show");
            });
        </script>
    </div>

    <div class="card-body">
        <div class="tab-content p-0">

            <!-- options tab -->
            <div class="tab-pane active" id="caesar-options-tab" role="tabpanel">
                <p class="card-text">
                    <!-- checkbox blocks of five -->
                    <div class="custom-control custom-checkbox mr-3 d-inline-block">
                        <input type="checkbox" class="custom-control-input" id="caesar-blocks-of-five-checkbox">
                        <label class="custom-control-label" for="caesar-blocks-of-five-checkbox">${{caesar.FIVE_BLOCKS}}$</label>
                    </div>
                    <!-- checkbox keep non alphabet chars -->
                    <div class="custom-control custom-checkbox mr-3 d-inline-block">
                        <input type="checkbox" class="custom-control-input" id="caesar-keep-non-alp-checkbox" checked>
                        <label class="custom-control-label" for="caesar-keep-non-alp-checkbox">${{caesar.KEEP_NON_ALP}}$</label>
                    </div>
                </p>
            </div>

            <!-- alphabet tab -->
            <div class="tab-pane" id="caesar-alphabet-tab" role="tabpanel" aria-labelledby="caesar-alphabet-tab-tab">
                <p class="card-text">

                    <!-- alphabet templates -->
                    <label class="mb-0">${{caesar.PLAINTEXT_ALPHABET_LABEL}}$</label>
                    <input id="caesar-plaintext-alphabet" class="form-control text-monospace mt-1" value="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz" spellcheck="false" disabled>
                    <label class="mb-0 mt-2">${{caesar.CIPHERTEXT_ALPHABET_LABEL}}$</label>
                    <input id="caesar-ciphertext-alphabet" class="form-control text-monospace mt-1 mb-2" value="BCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzA" spellcheck="false" disabled>

                    <div id="caesar-alphabet-templates" class="form-check form-check-inline">

                        <div class="custom-control custom-checkbox mr-3">
                            <input type="checkbox" class="custom-control-input" id="caesar-uppercase-checkbox" checked>
                            <label class="custom-control-label" for="caesar-uppercase-checkbox">${{caesar.UPPERCASE}}$</label>
                        </div>

                        <div class="custom-control custom-checkbox mr-3">
                            <input type="checkbox" class="custom-control-input" id="caesar-lowercase-checkbox" checked>
                            <label class="custom-control-label" for="caesar-lowercase-checkbox">${{caesar.LOWERCASE}}$</label>
                        </div>

                        <div class="custom-control custom-checkbox mr-3">
                            <input type="checkbox" class="custom-control-input" id="caesar-digits-checkbox">
                            <label class="custom-control-label" for="caesar-digits-checkbox">${{caesar.DIGITS}}$</label>
                        </div>

                        <div class="custom-control custom-checkbox mr-3">
                            <input type="checkbox" class="custom-control-input" id="caesar-punctuation-checkbox">
                            <label class="custom-control-label" for="caesar-punctuation-checkbox">${{caesar.PUNCTUATION_MARKS}}$</label>
                        </div>

                        <div class="custom-control custom-checkbox mr-3">
                            <input type="checkbox" class="custom-control-input" id="caesar-umlauts-checkbox">
                            <label class="custom-control-label" for="caesar-umlauts-checkbox">${{caesar.UMLAUTS}}$</label>
                        </div>

                        <div class="custom-control custom-checkbox mr-3">
                            <input type="checkbox" class="custom-control-input" id="caesar-blanks-checkbox">
                            <label class="custom-control-label" for="caesar-blanks-checkbox">${{caesar.BLANKS}}$</label>
                        </div>

                    </div>

                    <hr>

                    <!-- alphabet selection radiobuttons -->
                    <div class="form-check form-check-inline">

                        <div class="custom-control custom-radio mr-3">
                            <input type="radio" name="caesar-alphabet-radio" id="caesar-use-constructed-alphabet-radiobtn" class="custom-control-input" checked>
                            <label class="custom-control-label ml-1" for="caesar-use-constructed-alphabet-radiobtn">${{caesar.USE_CONSTRUCTED_ALPHABET}}$</label>
                        </div>

                        <div class="custom-control custom-radio mr-3">
                            <input type="radio" name="caesar-alphabet-radio" id="caesar-use-custom-alphabet-radiobtn" class="custom-control-input">
                            <label class="custom-control-label ml-1" for="caesar-use-custom-alphabet-radiobtn">${{caesar.DEFINE_OWN_ALPHABET}}$</label>
                        </div>

                    </div>

                </p>
            </div>

        </div>
    </div>
</div>

<!-- key section -->
<div class="form-inline mt-3">
    <span class="mr-2">${{caesar.KEY}}$:</span>
    <button class="btn btn-success" id="caesar-key-minus">-</button>
    <input id="caesar-key-input" class="form-control text-center w-auto" type="number" value="1" min="0" max="99">
    <button class="btn btn-success" id="caesar-key-plus">+</button>
</div>

<!-- output textarea -->
<div class="form-group mt-3 ml-auto mr-auto">
    <label for="caesar-output">${{caesar.OUTPUT_LABEL}}$</label>
    <textarea id="caesar-output" rows="4" class="form-control" spellcheck="false"></textarea>
</div>

<!-- ORIGINAL AUTHOR JEAN MICHEL POLAK -->


<hr>

<!-- Python implementations -->

<div class="alert alert-secondary">${{caesar.PYTHON_EXPLANATION}}$</div>

<div class="d-flex">
    <button id="caesar-run-as-python-local" class="btn btn-success mr-1">
        <i class="fa fa-play mr-1"></i> ${{caesar.RUN_AS_PYTHON}}$ (<b>${{caesar.LOCALLY}}$</b>)
    </button>
    <button id="caesar-run-as-python-remote" class="btn btn-success">
        <i class="fa fa-play mr-1"></i> ${{caesar.RUN_AS_PYTHON}}$ (<b>${{caesar.REMOTE}}$</b>)
    </button>
</div>

<!-- collapsable area of the local Python implementation -->
<div id="caesar-python-local-collapse" class="collapse pt-3">
    <div class="alert alert-info">${{editor.PYTHON_LOCAL_NOTICE}}$</div>
    @@include("./LocalEditor/LocalPythonEditor.html", {
        "codesource": "../local-python-code.py"
    })
</div>

<!-- collapsable area of the remote Python implementation -->
<div id="caesar-python-remote-collapse" class="collapse">
    <div class="alert alert-info mb-2 mt-3">${{caesar.PYTHON_REMOTE_NOTICE}}$</div>
    <iframe height="900px" width="100%" scrolling="no" frameborder="no" allowtransparency="true" allowfullscreen="true" sandbox="allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-modals"></iframe> <!-- src will be set via JS -->
</div>

<!-- <div id="secondEditor">
    @@ \ include("./LocalEditor/LocalPythonEditor.html", {
        "codesource": "../local-python-code.py"
    })
</div> -->

<script>

    let localPytonEditorObject
    let localPythonAssetsInserted = false

    const insertPythonAssets = (callback = () => {}) => {

        // only execute once
        if(localPythonAssetsInserted) return false

        // load stylesheets
        CTO_Globals.localPythonStyles.forEach(styleURL => {
            if(!styleURL.includes("://"))
                styleURL = CTO_Globals.pluginRoot + styleURL
            loadStylesheet(styleURL)
        })

        // load scripts
        const loadLocalPythonScripts = (index = 0) => {
            let scriptURL = CTO_Globals.localPythonScripts[index]
            if(!scriptURL.includes("://"))
                scriptURL = CTO_Globals.pluginRoot + scriptURL
            loadScript(scriptURL, (e) => {
                // load more scripts if available
                if(++index < CTO_Globals.localPythonScripts.length) loadLocalPythonScripts(index)
                // callback when all are loaded
                else languagePluginLoader.then(callback)
            })
        }

        loadLocalPythonScripts()
        localPythonAssetsInserted = true

    }

    /* let secondEditorObject
    const includeSecondEditorForTesting = () => {

        const spawnEditor = () => {
            let editorElem2 = document.getElementById("secondEditor")
            secondEditorObject = new LocalPythonEditor(editorElem2, pyodide, () => {
                console.log("yay, spawned the second one! :D")
            })
        }

        if(localPythonAssetsInserted) spawnEditor()
        else insertPythonAssets(() => { spawnEditor() })

    }; includeSecondEditorForTesting() */

    // toggle local collapse on button click
    $("#caesar-run-as-python-local").click(function() {
        $("#caesar-python-local-collapse").collapse("toggle")
        $("#caesar-python-remote-collapse").collapse("hide")
    })

    // when local collapse gets shown -> set button state, include Python editor, and use Python for calculations
    $("#caesar-python-local-collapse").on("show.bs.collapse", function() {
        $("#caesar-run-as-python-local").html('<i class="fa fa-chevron-up mr-1"></i> ${{caesar.HIDE_LOCAL_PYTHON}}$')

        // callback for when python is inizialized
        let usePythonNow = () => {
            window.usePython = true // use Python for calculations now
            caesar.render() // calculate and render output again
        }

        // insert assets for local Python editor
        let executed = insertPythonAssets(() => { // only executed once
            let editorElem = document.querySelector("#caesar-python-local-collapse")
            localPytonEditorObject = new LocalCaesarPythonEditor(editorElem, pyodide, caesar, usePythonNow)
        })

        if(executed === false) usePythonNow()
    })

    // when local collapse gets hidden -> set button state back again and stop using Python for calculations
    $("#caesar-python-local-collapse").on("hide.bs.collapse", function() {
        $("#caesar-run-as-python-local").html('<i class="fa fa-play mr-1"></i> ${{caesar.RUN_AS_PYTHON}}$ (<b>${{caesar.LOCALLY}}$</b>)')
        window.usePython = false
        caesar.render() // calculate with JS
    })

    // toggle remote collapse on button click
    $("#caesar-run-as-python-remote").click(function () {
        $("#caesar-python-local-collapse").collapse("hide")
        $("#caesar-python-remote-collapse").collapse("toggle")
    })

    // when remote collape gets shown -> set button state and iframe src
    $("#caesar-python-remote-collapse").on("show.bs.collapse", function() {
        $("#caesar-run-as-python-remote").html('<i class="fa fa-chevron-up mr-1"></i> ${{caesar.HIDE_REMOTE_PYTHON}}$')
        let iframe = $("#caesar-python-remote-collapse iframe")
        if(!iframe.attr("src")) iframe.attr("src", "https://repl.it/@arthurguiot/CaesarCipher?lite=true&embedded=true")
    })

    // when remote collapse gets hidden -> set button state back again
    $("#caesar-python-remote-collapse").on("hide.bs.collapse", function() {
        $("#caesar-run-as-python-remote").html('<i class="fa fa-play mr-1"></i> ${{caesar.RUN_AS_PYTHON}}$ (<b>${{caesar.REMOTE}}$</b>)')
    })

</script>
